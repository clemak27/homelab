---
apiVersion: fluxcd.controlplane.io/v1
kind: ResourceSet
metadata:
  name: services
  namespace: flux-system
  annotations:
    fluxcd.controlplane.io/reconcile: "enabled"
    fluxcd.controlplane.io/reconcileEvery: "30m"
    fluxcd.controlplane.io/reconcileTimeout: "5m"
spec:
  inputs:
    - name: blocky
    - name: miniflux
    - name: redlib
  resources:
    - apiVersion: kustomize.toolkit.fluxcd.io/v1
      kind: Kustomization
      metadata:
        name: << inputs.name >>
        namespace: services
      spec:
        interval: 10m
        targetNamespace: services
        sourceRef:
          kind: GitRepository
          name: homelab
          namespace: flux-system
        path: "./cluster2/services/<< inputs.name >>"
        prune: true
        timeout: 1m
        decryption:
          provider: sops
          secretRef:
            name: sops-age
