---
version: '3.8'

services:
  filebrowser:
    image: ${FILEBROWSER_SERVICE_IMAGE:?}:${FILEBROWSER_SERVICE_VERSION:?}
    container_name: ${FILEBROWSER_SERVICE_NAME:?}
    user: "${UID}:${GID}"
    ports:
      - "${FILEBROWSER_SERVICE_PORT:?}:${FILEBROWSER_INTERNAL_PORT:?}"
    volumes:
      - "${DOCKER_DATA:?}/${FILEBROWSER_SERVICE_NAME:?}:/config"
      - "${MEDIA_DATA:?}:/data/media"
      - "/var/mnt/archive:/data/archive"
      - "/var/mnt/emulation:/data/emulation"
    security_opt:
      - "label:disable"
    networks:
      - private
    environment:
      TZ: Europe/Vienna
      FB_PORT: "8755"
    labels:
      traefik.enable: true
      traefik.http.routers.filebrowser-router.entrypoints: https
      traefik.http.routers.filebrowser-router.rule: Host(`${FILEBROWSER_SERVICE_NAME:?}.${DOMAIN:?}`)
      traefik.http.routers.filebrowser-router.tls: true
      traefik.http.routers.filebrowser-router.tls.certresolver: letsEncrypt
      traefik.http.routers.filebrowser-router.service: ${FILEBROWSER_SERVICE_NAME:?}-service
      traefik.http.services.filebrowser-service.loadbalancer.server.port: ${FILEBROWSER_INTERNAL_PORT:?}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--tries=1", "--spider", "http://localhost:${FILEBROWSER_INTERNAL_PORT:?}/"]
      interval: 20s
      timeout: 60s
      start_period: 15s
