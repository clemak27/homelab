---
version: v1alpha1
machine:
  install:
    disk: /dev/mmcblk
    image: factory.talos.dev/image/3be8dcdb5d390122648d2336fc1e7a2dd584c8fc391492fc9ae009639b864a06:v1.10.0
    wipe: true
  kubelet:
    extraMounts:
      - destination: /var/lib/longhorn
        type: bind
        source: /var/lib/longhorn
        options:
          - bind
          - rshared
          - rw

  features:
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: true
  network:
    # # Wireguard specific configuration.

    # # wireguard server example
    # wireguard:
    #     privateKey: ABCDEF... # Specifies a private key configuration (base64 encoded).
    #     listenPort: 51111 # Specifies a device's listening port.
    #     # Specifies a list of peer configurations to apply to a device.
    #     peers:
    #         - publicKey: ABCDEF... # Specifies the public key of this peer.
    #           endpoint: 192.168.1.3 # Specifies the endpoint of this peer entry.
    #           # AllowedIPs specifies a list of allowed IP addresses in CIDR notation for this peer.
    #           allowedIPs:
    #             - 192.168.1.0/24
    # # wireguard peer example
    # wireguard:
    #     privateKey: ABCDEF... # Specifies a private key configuration (base64 encoded).
    #     # Specifies a list of peer configurations to apply to a device.
    #     peers:
    #         - publicKey: ABCDEF... # Specifies the public key of this peer.
    #           endpoint: 192.168.1.2:51822 # Specifies the endpoint of this peer entry.
    #           persistentKeepaliveInterval: 10s # Specifies the persistent keepalive interval for this peer.
    #           # AllowedIPs specifies a list of allowed IP addresses in CIDR notation for this peer.
    #           allowedIPs:
    #             - 192.168.1.0/24

    # # Virtual (shared) IP address configuration.

    # # layer2 vip example
    # vip:
    #     ip: 172.16.199.55 # Specifies the IP address to be used.
    # Allows for extra entries to be added to the `/etc/hosts` file
    # extraHostEntries:
    #   - ip: 192.168.178.100  # The IP of the host.
    #     # The host alias.
    #     aliases:
    #       - wallstreet30.cc
    interfaces:
      - deviceSelector:
          physical: true
        dhcp: true
        vip:
          ip: 10.0.30.25

cluster:
  controlPlane:
    endpoint: https://192.168.178.102:6443
  clusterName: rpi
  network:
    dnsDomain: cluster.local

  apiServer:
    certSANs:
      - 192.168.178.102
  allowSchedulingOnControlPlanes: true

  proxy:
    extraArgs:
      nodeport-addresses: 0.0.0.0/0
