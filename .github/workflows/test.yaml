---
name: test
on:
  - pull_request
jobs:
  docker-compose:
    runs-on: ubuntu-latest
    env:
      DEPLOY_TEST: true
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Test docker-compose file
        run: cd services && ./deploy.sh
  ignition:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Nix setup
        uses: cachix/install-nix-action@v16
      - name: Run ignition test
        run: nix shell nixpkgs#gnumake nixpkgs#butane -c make test
  homelab_bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Go setup
        uses: actions/setup-go@v3
        with:
          go-version: 1.19.1
      - name: Test homelab_bot
        run: cd services/homelab_bot/src && make test
