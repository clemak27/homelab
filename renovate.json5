{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "branchPrefix": "renovate/",
  "gitAuthor": "Renovate Bot <bot@renovateapp.com>",
  "forkProcessing": "disabled",
  "commitMessageAction": "update",
  "flux": {
    "fileMatch": ["flux/.+\\.ya?ml$"]
  },
  "packageRules": [
    {
      "matchPackagePatterns": [
        "docker.io/linuxserver/transmission"
      ],
      "allowedVersions": "< 2021"
    },
    {
      "matchPackageNames": [
        "fluxcd/flux2",
        "flux2"
      ],
      "groupName": "fluxcd"
    },
    {
      "matchPackageNames": [
        "ghcr.io/immich-app/immich-server",
        "ghcr.io/immich-app/immich-machine-learning"
      ],
      "groupName": "immich"
    },
    {
      "matchManagers": ["mise"],
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "automerge": true
    },
    {
      "matchFileNames": [
        "flux/apps/homelab/media/**"
      ],
      "semanticCommitScope": "media",
      "semanticCommitType": "fix"
    },
    {
      "matchFileNames": [
        "flux/apps/homelab/monitoring/**"
      ],
      "semanticCommitScope": "monitoring",
      "semanticCommitType": "fix"
    },
    {
      "matchFileNames": [
        "flux/apps/homelab/services/**"
      ],
      "semanticCommitScope": "services",
      "semanticCommitType": "fix"
    },
    {
      "matchFileNames": [
        "flux/infrastructure/**"
      ],
      "semanticCommitScope": "infrastructure",
      "semanticCommitType": "fix"
    },
    {
      "matchFileNames": [
        "flux/clusters/**"
      ],
      "extends": [
        ":semanticCommitScopeDisabled"
      ],
      "semanticCommitType": "fix"
    }
  ],
  "ignorePaths": [
    "flux/apps/homelab/media/slskd-importer"
  ],
  "regexManagers": [
    {
      "fileMatch": [
        ".*\\.sh"
      ],
      // https://regex101.com/r/EArT8p/1
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\sexport \\S+?=(?<currentValue>\\S+)"
      ]
    },
    {
      "fileMatch": [".*\\.container$"],
      // https://regex101.com/r/1ysnFY/1
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s\\S+?=.+:(?<currentValue>\\S+)"
      ]
    }
  ]
}
